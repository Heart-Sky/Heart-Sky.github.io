<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">

    

    <title>
      web-for-pentest | HeartSky&#39;s blog 
    </title>

    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    
      <meta name="author" content="HeartSky">
    
    

    <meta name="description" content="学了一些xss和sql的知识后，没有找到好的练习平台，便去求助学长，然后土土学长推荐我看下lightless学长发的web for pentest。下载后安装在虚拟机里，整个前期准备很简单，下面开始试下水 XSSExample1看到Hello hacker，然后url中有name=hacker，换个字符试下，果然，是php获取$_GET[‘name’]的值，然后输出出来，和自己最初学习xss时练习">
<meta name="keywords" content="XSS,SQLi,Pentest">
<meta property="og:type" content="article">
<meta property="og:title" content="web-for-pentest | HeartSky&#39;s blog">
<meta property="og:url" content="http://heartsky.info/2016/04/26/web-for-pentest/index.html">
<meta property="og:site_name" content="HeartSky&#39;s blog">
<meta property="og:description" content="学了一些xss和sql的知识后，没有找到好的练习平台，便去求助学长，然后土土学长推荐我看下lightless学长发的web for pentest。下载后安装在虚拟机里，整个前期准备很简单，下面开始试下水 XSSExample1看到Hello hacker，然后url中有name=hacker，换个字符试下，果然，是php获取$_GET[‘name’]的值，然后输出出来，和自己最初学习xss时练习">
<meta property="og:updated_time" content="2017-11-15T06:18:36.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="web-for-pentest | HeartSky&#39;s blog">
<meta name="twitter:description" content="学了一些xss和sql的知识后，没有找到好的练习平台，便去求助学长，然后土土学长推荐我看下lightless学长发的web for pentest。下载后安装在虚拟机里，整个前期准备很简单，下面开始试下水 XSSExample1看到Hello hacker，然后url中有name=hacker，换个字符试下，果然，是php获取$_GET[‘name’]的值，然后输出出来，和自己最初学习xss时练习">
    
    
    
      <link rel="icon" type="image/x-icon" href="/favicon.png">
    
    <link rel="stylesheet" href="/css/uno.css">
    <link rel="stylesheet" href="/css/highlight.css">
    <link rel="stylesheet" href="/css/archive.css">
    <link rel="stylesheet" href="/css/china-social-icon.css">

</head>
<body>

    <span class="mobile btn-mobile-menu">
        <i class="icon icon-list btn-mobile-menu__icon"></i>
        <i class="icon icon-x-circle btn-mobile-close__icon hidden"></i>
    </span>

    

<header class="panel-cover panel-cover--collapsed">


  <div class="panel-main">

  
    <div class="panel-main__inner panel-inverted">
    <div class="panel-main__content">

        

        <h1 class="panel-cover__title panel-title"><a href="/" title="link to homepage">HeartSky&#39;s blog</a></h1>
        <hr class="panel-cover__divider" />

        
        <p class="panel-cover__description">
          在渗透之路上渐行渐远
        </p>
        <hr class="panel-cover__divider panel-cover__divider--secondary" />
        

        <div class="navigation-wrapper">

          <nav class="cover-navigation cover-navigation--primary">
            <ul class="navigation">

              
                
                <li class="navigation__item"><a href="/#blog" title="" class="blog-button">首页</a></li>
              
                
                <li class="navigation__item"><a href="/about" title="" class="">关于</a></li>
              
                
                <li class="navigation__item"><a href="/archive" title="" class="">归档</a></li>
              
                
                <li class="navigation__item"><a href="/friends" title="" class="">友链</a></li>
              

            </ul>
          </nav>

          <!-- ----------------------------
To add a new social icon simply duplicate one of the list items from below
and change the class in the <i> tag to match the desired social network
and then add your link to the <a>. Here is a full list of social network
classes that you can use:

    icon-social-500px
    icon-social-behance
    icon-social-delicious
    icon-social-designer-news
    icon-social-deviant-art
    icon-social-digg
    icon-social-dribbble
    icon-social-facebook
    icon-social-flickr
    icon-social-forrst
    icon-social-foursquare
    icon-social-github
    icon-social-google-plus
    icon-social-hi5
    icon-social-instagram
    icon-social-lastfm
    icon-social-linkedin
    icon-social-medium
    icon-social-myspace
    icon-social-path
    icon-social-pinterest
    icon-social-rdio
    icon-social-reddit
    icon-social-skype
    icon-social-spotify
    icon-social-stack-overflow
    icon-social-steam
    icon-social-stumbleupon
    icon-social-treehouse
    icon-social-tumblr
    icon-social-twitter
    icon-social-vimeo
    icon-social-xbox
    icon-social-yelp
    icon-social-youtube
    icon-social-zerply
    icon-mail

-------------------------------->

<!-- add social info here -->



        </div>

      </div>

    </div>

    <div class="panel-cover--overlay"></div>
  </div>
</header>

    <div class="content-wrapper">
        <div class="content-wrapper__inner entry">
            

<article class="post-container post-container--single">

  <header class="post-header">
    
    <h1 class="post-title">web-for-pentest</h1>

    

    <div class="post-meta">
      <time datetime="2016-04-26" class="post-meta__date date">2016-04-26</time> 

      <span class="post-meta__tags tags">

          

          
             &#8226; 标签:
            <font class="tags">
              <a class="tags-link" href="/tags/Pentest/">Pentest</a>, <a class="tags-link" href="/tags/SQLi/">SQLi</a>, <a class="tags-link" href="/tags/XSS/">XSS</a>
            </font>
          

      </span>
    </div>
    
    

  </header>

  <section id="post-content" class="article-content post">
    <p>学了一些xss和sql的知识后，没有找到好的练习平台，便去求助学长，然后土土学长推荐我看下lightless学长发的web for pentest。下载后安装在虚拟机里，整个前期准备很简单，下面开始试下水</p>
<h2 id="XSS"><a href="#XSS" class="headerlink" title="XSS"></a>XSS</h2><h3 id="Example1"><a href="#Example1" class="headerlink" title="Example1"></a>Example1</h3><p>看到<code>Hello hacker</code>，然后url中有<code>name=hacker</code>，换个字符试下，果然，是php获取$_GET[‘name’]的值，然后输出出来，和自己最初学习xss时练习的一样。试下<code>&lt;script&gt;alert(&#39;xss&#39;)&lt;/script&gt;</code>,成功弹窗</p>
<h3 id="Example2"><a href="#Example2" class="headerlink" title="Example2"></a>Example2</h3><p>先输入上面的最基本的payload试下，发现<script>和</script>被过滤了，那就构造<code>&lt;scr&lt;script&gt;ipt&gt;alert(%27xss%27)&lt;/scr&lt;/script&gt;ipt&gt;</code></p>
<h3 id="Example3"><a href="#Example3" class="headerlink" title="Example3"></a>Example3</h3><p>这题用第二题的payload就可以弹窗，不知道和第二题有什么区别</p>
<h3 id="Example4"><a href="#Example4" class="headerlink" title="Example4"></a>Example4</h3><p>输入script时就会全部替换为error,那就用img标签，<code>&lt;img src=&quot;&quot; onerror=&quot;alert(&#39;xss&#39;)&quot;&gt;</code>，做到这已经明白这个系列了，绕过各种过滤</p>
<h3 id="Example5"><a href="#Example5" class="headerlink" title="Example5"></a>Example5</h3><p>不能输入alert,考虑String.fromCharCode()函数，<code>&lt;img src=&quot;&quot; onerror=eval(String.fromCharCode(97,108,101,114,116,40,39,88,83,83,39,41))&gt;</code></p>
<h3 id="Example6"><a href="#Example6" class="headerlink" title="Example6"></a>Example6</h3><p>怎么输都不显示，后来f12看了下，发现输入的字符赋给了$a（开始变换姿势了）,既然如此，就很简单了，<code>&quot;;alert(%27xss%27);//</code></p>
<h3 id="Example7"><a href="#Example7" class="headerlink" title="Example7"></a>Example7</h3><p>上面的双引号换成了单引号，思路不变，<code>&#39;;alert(%27xss%27);//</code></p>
<h3 id="Example8"><a href="#Example8" class="headerlink" title="Example8"></a>Example8</h3><p>题目换成了一个输入框，点击发送时会把里面的内容原样显示出来，毫无思路，看了下其他人写的题解，表单的目标url是可以构造的，于是可以这样<code>&quot;%20onsubmit=&quot;alert(&#39;xss&#39;)</code>,用户点击时就会弹窗</p>
<h3 id="Example9"><a href="#Example9" class="headerlink" title="Example9"></a>Example9</h3><p>查看源码，<code>document.write(location.hash.substring(1));</code>，输出从#开始的url，换汤不换药，思路不变，过滤了<code>&lt;script&gt;</code>,第四题的payload就可以,<code>&lt;img src=&quot;&quot; onerror=&quot;alert(&#39;xss&#39;)&quot;&gt;</code></p>
<p>今天晚上做出来了xss部分是一个好的开始，睡觉，明天继续!顺便再研究下md语法！</p>
<hr>
<h2 id="SQL-injections"><a href="#SQL-injections" class="headerlink" title="SQL injections"></a>SQL injections</h2><p>下载东西设置定时关机，忘记保存wp，只能重新写这部分，血的教训！</p>
<h3 id="Example1-1"><a href="#Example1-1" class="headerlink" title="Example1"></a>Example1</h3><p>单引号字符型注入，不会报错，最基本的，<code>&#39; or &#39;1&#39;=&#39;1</code></p>
<h3 id="Example2-1"><a href="#Example2-1" class="headerlink" title="Example2"></a>Example2</h3><p>还是字符型，先试下上面的payload，提示<code>ERROR NO SPACE</code>,那就把空格删了，<code>&#39;or&#39;1&#39;=&#39;1</code>,结果可以了，所以不用空格也是可以的？</p>
<h3 id="Example3-1"><a href="#Example3-1" class="headerlink" title="Example3"></a>Example3</h3><p>提示和解法都和第二题一样，难道是我误会了出题者的意思 = =？</p>
<h3 id="Example4-1"><a href="#Example4-1" class="headerlink" title="Example4"></a>Example4</h3><p>换成了数字型，<code>2 or 1=1</code></p>
<h3 id="Example5-1"><a href="#Example5-1" class="headerlink" title="Example5"></a>Example5</h3><p>和上面题一样</p>
<h3 id="Example6-1"><a href="#Example6-1" class="headerlink" title="Example6"></a>Example6</h3><p>还是同样的注入，我有点慌了</p>
<h3 id="Example7-1"><a href="#Example7-1" class="headerlink" title="Example7"></a>Example7</h3><p>终于有变化了，先输入上面的payload后提示<code>ERROR INTEGER REQUIRED</code>,然后我就不会做了。。。</p>
<h3 id="Example8-1"><a href="#Example8-1" class="headerlink" title="Example8"></a>Example8</h3><p>order by语句的话，在mysql中是<code>SELECT * FROM users ORDER BY name</code>或<code>ORDER BY `name` </code>，试下<code>name`;%23</code>，输出不变,所以这题是第二种，位于反引号内</p>
<h3 id="Example9-1"><a href="#Example9-1" class="headerlink" title="Example9"></a>Example9</h3><p>和上面那题类似，只不过是采用的第一种语句，<code>name and 1=1</code>，输出结果不变，然后就就可以自由发挥了</p>
<p>整体来说比较基本，而且lightless学长说过，</p>
<blockquote>
<p>盲注才是注入的精髓</p>
</blockquote>
<p>所以sql注入方面下一步学习用php写盲注脚本</p>
<hr>
<h5 id="2016-7-28-最近在看《白帽子讲web安全》这本书，想起来这里有一些合适的题，便来做一下"><a href="#2016-7-28-最近在看《白帽子讲web安全》这本书，想起来这里有一些合适的题，便来做一下" class="headerlink" title="2016.7.28 最近在看《白帽子讲web安全》这本书，想起来这里有一些合适的题，便来做一下"></a>2016.7.28 最近在看《白帽子讲web安全》这本书，想起来这里有一些合适的题，便来做一下</h5><h2 id="File-Include"><a href="#File-Include" class="headerlink" title="File Include"></a>File Include</h2><p>分为本地文件包含(Local File Inclusion)和远程文件包含(Remote File Inclusion)</p>
<h3 id="Example-1"><a href="#Example-1" class="headerlink" title="Example 1"></a>Example 1</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">example1.php?page=intro.php</span><br></pre></td></tr></table></figure>
<p>修改<code>intro.php</code>，可以包含其他文件</p>
<h3 id="Example-2"><a href="#Example-2" class="headerlink" title="Example 2"></a>Example 2</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">example2.php?page=intro</span><br></pre></td></tr></table></figure>
<p>和上题差不多，只不过默认文件名是.php，只要用%00截断就可以了</p>
<hr>
<h2 id="File-Upload"><a href="#File-Upload" class="headerlink" title="File Upload"></a>File Upload</h2><h3 id="Example-1-1"><a href="#Example-1-1" class="headerlink" title="Example 1"></a>Example 1</h3><p>没有过滤，可以直接上传脚本<br>比如本地有一个test.php的文件，内容是<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">	phpinfo();</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>这样就可以看到有关PHP配置的信息</p>
<h3 id="Example-2-1"><a href="#Example-2-1" class="headerlink" title="Example 2"></a>Example 2</h3><p>要求上传图像文件，测试了下是黑名单，所以这里利用Apache对文件名从后向前解析、遇到不认识的文件类型向前遍历的特性，把本地的文件名修改为<code>test.php.aaa</code></p>
<hr>
<h2 id="Code-injection"><a href="#Code-injection" class="headerlink" title="Code injection"></a>Code injection</h2><p>代码注入是因为不安全的函数或方法没有被禁用(如eval()，system())，而且没有对用户的输入数据做处理，导致攻击者修改输入数据执行了自己想要的命令</p>
<h3 id="Example-1-2"><a href="#Example-1-2" class="headerlink" title="Example 1"></a>Example 1</h3><p>GET请求为<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">name=hacker</span><br></pre></td></tr></table></figure></p>
<p>输出为<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Hello hacker!!!</span><br></pre></td></tr></table></figure></p>
<p>猜测代码可能是这样<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$name = $_GET[<span class="string">'name'</span>];</span><br><span class="line"><span class="keyword">eval</span>(<span class="string">'echo "Hello $name!!!"'</span>);</span><br></pre></td></tr></table></figure></p>
<p>构造GET请求(第一个<code>;</code>可替换为<code>.</code>)<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">name=<span class="string">";phpinfo();$a="</span></span><br><span class="line"><span class="keyword">eval</span>(<span class="string">'echo "";phpinfo();$a="";'</span>);</span><br></pre></td></tr></table></figure></p>
<p>或者( <code>//</code> 替换为 <code>#</code> 也可以 )<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">name=<span class="string">".phpinfo();//</span></span><br><span class="line"><span class="string">eval('echo "</span><span class="string">".phpinfo();//');</span></span><br></pre></td></tr></table></figure></p>
<h3 id="Example-2-2"><a href="#Example-2-2" class="headerlink" title="Example 2"></a>Example 2</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">order=);&#125;phpinfo();<span class="comment">//</span></span><br></pre></td></tr></table></figure>
<p>这题有点想不通源码怎么写的，先放上别人的答案吧</p>
<h3 id="Example-3"><a href="#Example-3" class="headerlink" title="Example 3"></a>Example 3</h3><p>GET请求为<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span>=hacker&amp;pattern=/lamer/&amp;base=Hello%<span class="number">20</span>lamer</span><br></pre></td></tr></table></figure></p>
<p>输出为<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Hello hacker</span><br></pre></td></tr></table></figure></p>
<p>经过测试后发现 /string/ 里的 string 被替换成了 new 的值，源码大概是这样<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$new = $_GET[<span class="string">'new'</span>];</span><br><span class="line">$pattern = $_GET[<span class="string">'pattern'</span>];</span><br><span class="line">$base = $_GET[<span class="string">'base'</span>];</span><br><span class="line">preg_replace($pattern,$new,$base);</span><br></pre></td></tr></table></figure></p>
<p>这题的关键在于<code>/e</code>修饰符会使函数preg_replace()在替换时把替换字符串当做PHP代码来执行，所以我们可以让new=phpinfo()，不过要注意的是<strong><code>/e</code>修饰符从PHP5.5.0开始已经被弃用了</strong></p>
<h3 id="Example-4"><a href="#Example-4" class="headerlink" title="Example 4"></a>Example 4</h3><p>GET请求为<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">name=hacker</span><br></pre></td></tr></table></figure></p>
<p>输出为<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Hello hacker</span><br></pre></td></tr></table></figure></p>
<p>当提交单引号时出现错误信息<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Parse error: syntax error, unexpected T_ENCAPSED_AND_WHITESPACE in /var/www/codeexec/example4.php(4) : assert code on line 1 Catchable fatal error: assert(): Failure evaluating code: &apos;hacker&apos;&apos; in /var/www/codeexec/example4.php on line 4</span><br></pre></td></tr></table></figure></p>
<p>可以看到后面是错误执行代码’hacker’’，那么我们可以先闭合单引号然后直接注入代码<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hacker&apos;.phpinfo().&apos;</span><br></pre></td></tr></table></figure></p>
<hr>
<h2 id="Commands-injection"><a href="#Commands-injection" class="headerlink" title="Commands injection"></a>Commands injection</h2><p>命令注入，即应用程序把用户的输入(URL，请求参数以及cookie)当做了OS命令的一部分来执行</p>
<h3 id="Example-1-3"><a href="#Example-1-3" class="headerlink" title="Example 1"></a>Example 1</h3><p>ping命令，对用户数据没有任何的检测，修改GET请求为<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ip=127.0.0.1 %26%26 cat /etc/passwd</span><br></pre></td></tr></table></figure></p>
<p>%26是<code>&amp;</code>的URL编码，必须进行编码，否则无法执行命令</p>
<h3 id="Example-2-3"><a href="#Example-2-3" class="headerlink" title="Example 2"></a>Example 2</h3><p>和上题一样，也是ping命令，不过加了验证，注入上面的payload输出Invalid IP address，检测是否是一个正确的IP地址，这里我们可以用换行符(%0a)<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ip=127.0.0.1%0acat /etc/passwd</span><br></pre></td></tr></table></figure></p>
<h3 id="Example-3-1"><a href="#Example-3-1" class="headerlink" title="Example 3"></a>Example 3</h3><p>依然是ping命令，先测试前两个payload看下输出，均重定向到了<code>example3.php?ip=127.0.0.1</code>,问但题在于是执行完命令后再跳转的，所以可以通过抓包看到注入结果</p>
<hr>
<h2 id="XML-attacks"><a href="#XML-attacks" class="headerlink" title="XML attacks"></a>XML attacks</h2><p>这里的XML和下面的LDAP以前都没接触过，那就现学吧</p>
<h3 id="Example-1-4"><a href="#Example-1-4" class="headerlink" title="Example 1"></a>Example 1</h3><p>GET请求为<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xml=&lt;test&gt;hacker&lt;/test&gt;</span><br></pre></td></tr></table></figure></p>
<p>输出为<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Hello hacker</span><br></pre></td></tr></table></figure></p>
<p>这里存在XML外部实体(XXE)注入漏洞<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xml=&lt;!DOCTYPE a [&lt;!ENTITY xxe SYSTEM &quot;file:///etc/passwd&quot;&gt;]&gt;&lt;test&gt;%26xxe;&lt;/test&gt;</span><br></pre></td></tr></table></figure></p>
<p>这里我们定义了一个实体引用<code>&amp;xxe;</code>，XML解析器会提取指定文件的内容并用它替代这个实体引用，所以就可以得到服务器上文件的内容</p>
<h3 id="Example-2-4"><a href="#Example-2-4" class="headerlink" title="Example 2"></a>Example 2</h3><p>GET请求为<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">name=hacker</span><br></pre></td></tr></table></figure></p>
<p>输出和上题一样，注入单引号后根据错误信息可以看出使用XPath(XML路径语言)来查询XML文档中的节点，源码是看的别人的，刚接触实在想不出来<br><figure class="highlight xpath"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[PARENT NODES]/name[.=<span class="string">'[INPUT]'</span>]/[CHILD NODES]</span><br></pre></td></tr></table></figure></p>
<p>所以可以构造语句(NULL字节是XPath中的注释符，URL编码为%00)<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">name=hacker&apos; or 1=1]/../child::node()%00</span><br></pre></td></tr></table></figure></p>
<p>可以查询父节点下的所有子节点<br>这里就不再继续了，等之后再深入研究吧</p>
<hr>
<h2 id="LDAP-attacks"><a href="#LDAP-attacks" class="headerlink" title="LDAP attacks"></a>LDAP attacks</h2><p>LDAP(轻量级目录访问协议)用于访问网络中的目录(分级结构的数据存储区)服务。有三种查询方法，简单匹配条件(匹配单个值)，析取查询(满足其中任何一个条件)，合取查询(满足所有条件)<br>例如 (user=test) (!(user=test1)(user=test2)) (&amp;(user=test)(pass=test)) 分别表示了上面三种查询方法 </p>
<h3 id="Example-1-5"><a href="#Example-1-5" class="headerlink" title="Example 1"></a>Example 1</h3><p>GET请求为<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">username=hacker&amp;password=hacker</span><br></pre></td></tr></table></figure></p>
<p>问题在于在一些LDAP的服务器中，如果没有请求参数值被发送，LDAP服务器将会绑定连接，而且PHP代码将会认为验证正确</p>
<blockquote>
<p>Some LDAP servers authorise NULL Bind: if null values are sent, the LDAP server will proceed to bind the connection, and the PHP code will think that the credentials are correct.</p>
</blockquote>
<p>所以可以把GET请求删掉，就会输出AUTHENTICATED，这让我想起了土师傅出的那道验证码题也是删掉请求，只不过那是POST请求，需要抓包，而且是故意造的洞，无论你输入什么都不会得到flag</p>
<h3 id="Example-2-5"><a href="#Example-2-5" class="headerlink" title="Example 2"></a>Example 2</h3><p>GET请求和上题一样，输出为<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">AUTHENTICATED as hacker</span><br></pre></td></tr></table></figure></p>
<p>如果我们想要以admin身份登录呢？<br>经测试推测出过滤器源码<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(&amp;(name=[input1])(password=HASH[input2]))</span><br></pre></td></tr></table></figure></p>
<p>可以这样<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">name=admin))%00&amp;password=233</span><br></pre></td></tr></table></figure></p>
<p>LDAP本身并不支持注释，但它在处理NULL字节时会立即终止字符串的漏洞造成了可以完成”注释”<br>还有一种常用的方法是<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">name=admin))(&amp;(name=233&amp;password=233</span><br><span class="line">(&amp;(name=admin))(&amp;(name=233)(password=233))</span><br></pre></td></tr></table></figure></p>
<p>这样就有了两个搜索过滤器，但只有一部分LDAP允许使用多个过滤器(选择性使用)，比如这题就不可以</p>
<hr>
<h2 id="Directory-traversal"><a href="#Directory-traversal" class="headerlink" title="Directory traversal"></a>Directory traversal</h2><p>目录遍历漏洞。没有给出连接，只有三个头像，果断F12查看以下，果然有图片的路径。那么就开始吧，这里我们以获取 /etc/passwd 为例</p>
<h3 id="Example-1-6"><a href="#Example-1-6" class="headerlink" title="Example 1"></a>Example 1</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;img src=&quot;dirtrav/example1.php?file=hacker.png&quot; width=&quot;20&quot;&gt;</span><br></pre></td></tr></table></figure>
<p>猜测可能是当前目录，那么向上查询试试<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://192.168.253.128/dirtrav/example1.php?file=../../../etc/passwd</span><br></pre></td></tr></table></figure></p>
<h3 id="Example-2-6"><a href="#Example-2-6" class="headerlink" title="Example 2"></a>Example 2</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;img src=&quot;dirtrav/example2.php?file=/var/www/files/hacker.png&quot; width=&quot;20&quot;&gt;</span><br></pre></td></tr></table></figure>
<p>这题就很简单了，绝对路径都有了，向上返回三次就到达根目录了<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://192.168.253.128/dirtrav/example2.php?file=/var/www/files/../../../etc/passwd</span><br></pre></td></tr></table></figure></p>
<h3 id="Example-3-2"><a href="#Example-3-2" class="headerlink" title="Example 3"></a>Example 3</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;img src=&quot;dirtrav/example3.php?file=hacker&quot; width=&quot;20&quot;&gt;</span><br></pre></td></tr></table></figure>
<p>很明显和第一题是一样的，只不过自动帮你加上了.png后缀，可以用%00截断嘛<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://192.168.253.128/dirtrav/example3.php?file=../../../etc/passwd%00</span><br></pre></td></tr></table></figure></p>
<p>挺简单的，这里有一个小技巧，你不用逐层向上查询，因为<code>cd /../</code>，还是在根目录，所以直接用很多<code>../</code>，根本不用一个个的向上试</p>
<p>做到这里这个镜像内的题目就结束了，收获还是挺多的，知道了命令注入、代码注入、文件包含、文件上传、目录遍历、LDAP注入、XML注入等等的基本思路和原理，学的越多，越感到自己的无知，何况自己才刚入门，希望接下来的一个月能够学到更多的东西吧 :)</p>

  </section>

  
  
</article>


            <script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js">
</script>
<footer class="footer">
    <span id="busuanzi_container_page_pv">
      本文总阅读量<span id="busuanzi_value_page_pv"></span>次
    </span>
<span id="busuanzi_container_site_uv">
  本站访客数<span id="busuanzi_value_site_uv"></span>人次
</span>
    <span class="footer__copyright">&copy; 2016-2017. | 由<a href="https://hexo.io/">Hexo</a>强力驱动 | 主题<a href="https://github.com/someus/huno">Huno</a> | <a href="https://coding.net/u/HeartSky/p/HeartSky/git/pages">Hosted by Coding Pages</a></span>  
</footer>

        </div>
    </div>

    <!-- js files -->
    <script src="/js/jquery.min.js"></script>
    <script src="/js/main.js"></script>
    <script src="/js/scale.fix.js"></script>
    

    

    <script type="text/javascript" src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript"> 
        $(document).ready(function(){
            MathJax.Hub.Config({ 
                tex2jax: {inlineMath: [['$','$'],['[latex]','[/latex]'], ['\\(','\\)']]} 
            });
        });
    </script>



    

    <script src="/js/awesome-toc.min.js"></script>
    <script>
        $(document).ready(function(){
            $.awesome_toc({
                overlay: true,
                contentId: "post-content",
            });
        });
    </script>


    <script src="http://s11.cnzz.com/z_stat.php?id=1259147269&web_id=1259147269" language="JavaScript"></script>
    
    <!--kill ie6 -->
<!--[if IE 6]>
  <script src="//letskillie6.googlecode.com/svn/trunk/2/zh_CN.js"></script>
<![endif]-->

</body>
</html>
